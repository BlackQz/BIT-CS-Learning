# 汇编语言与接口设计

## 微处理器管理模式

### CPU工作模式

从80386开始，32位CPU具有3种运行模式

- 实模式

  等同于16位8086处理器，DOS操作系统运行在实模式下

  不支持硬件上多任务切换，不支持特权级，可执行所有特权命令

- 保护模式

  支持内存分页机制，提供段式和页式内存管理

  支持多任务和特权级，共有**4个特权级**，最高为0，最低为3

- 虚拟8086模式

  经过"修改"的保护模式，给每个虚拟8086模式运行的任务创造了类似的环境，便于执行DOS程序

  

<img src="汇编语言与接口设计.assets/image-20210327153606338.png" alt="image-20210327153606338" style="zoom:80%;" />

### 寄存器

可分为

- 程序可见寄存器组：汇编语言程序员在设计应用程序时可以使用的寄存器
- 程序不可见寄存器组：应用程序设计不能直接使用，但系统程序或系统运行程序期间可能要用到的寄存器

#### 程序可见寄存器组

汇编语言程序员在设计应用程序时可以使用的寄存器

<img src="汇编语言与接口设计.assets/image-20210327155834826.png" alt="image-20210327155834826" style="zoom:80%;" />

- 通用寄存器

  - 数据寄存器

    - 8位：  AL/AH BL/BH CL/CH DL/DH 
    - 16位：AX       BX        CX       DX
    - 32位：EAX      EBX    ECX     EDX

  - 指针寄存器

    - 堆栈指针

      实模式使用SP；保护模式使用ESP；

    - 基址指针

      实模式使用BP；保护模式使用EBP；

  - 变址寄存器：存放地址偏移量部分或数据

    实模式使用SI、 DI；保护模式使用ESI、 EDI；

- 段寄存器：用于确定一个存储段在内存中的起始地址，存放的是当前正在运行程序的**段选择符**

  - 代码段寄存器CS
  - 堆栈段寄存器SS
  - 数据段寄存器DS
  - 附加数据段寄存器ES

- 控制寄存器

  注意：在程序中不能直接引用控制寄存器名。  

  - 指令指针寄存器IP/EIP  

    与CS段寄存器配合指出下一条要执行指令的地址，其中存放**偏移量部分**。  

  - 标志寄存器FLAGS/EFLAGS） 

    <img src="汇编语言与接口设计.assets/image-20210327162641806.png" alt="image-20210327162641806" style="zoom:80%;" />

    - CF：进位标识符
    - PF：奇偶标识符
    - AF：辅助进位标识符，用于十进制算数运算指令
    - ZF：零标志，运算结果为0时为1
    - SF：符号标志，运算结果为-时为1
    - TF：陷阱标志，用于程序调试
    - IF：中断允许标志
    - DF：方向标志
    - OF：溢出标志
    - IOPL：占两位，表示IO特权级
    - NT：只用于保护模式，表示当前任务是否嵌套在别的程序中
    - RF：在程序调试时使用
    - VM：为1时表示工作在v86模式
    - AC：地址对齐检查标志，为1时进行检查
    - VIF：虚拟中断标志
    - VIP：虚拟中断挂起标志
    - ID

#### 保护模式下的寄存器

- 全局描述符表寄存器GDTR

  可被所有任务访问，GDTR存储了全局描述符表GDT在内存中的基址（线性地址）和限长

  可通过LGDT将描述符表起始位置装入GDTR

  <img src="汇编语言与接口设计.assets/image-20210327165026687.png" alt="image-20210327165026687" style="zoom:50%;" />

- 中断描述符表寄存器LDTR

  

- 局部描述符表寄存器LDTR





### 任务

每个任务由两部分组成

- 任务执行环境TES
- 任务状态段TSS

